#/bin/bash

lines="custom,0010080100001000,100,BID,GTC,Y,90101=DMA
custom,0010080100001000,100,BID,GTC,N,66.35,90101=DMA
custom,0010080100001000,100,BID,GTC,N,0.0,90101=DMA
custom,0010080100001000,100,BID,GTC,N,0.0000001,90101=DMA
custom,0010080100001000,100,BID,GTC,N,-0.0000001,90101=DMA
custom,0010080100001000,100,BID,GTC,N,415.9999999999,90101=DMA
custom,0010080100001000,100,BID,GTC,N,-415.9999999999,90101=DMA
custom,0010080100001000,100,BID,GTC,N,312.99999999,90101=DMA
custom,0010080100001000,100,BID,GTC,N,-312.99999999,90101=DMA
custom,0010080100001000,100,BID,GTC,N,12555546.58,90101=DMA
custom,0010080100001000,100,BID,GTC,N,-12555546.58,90101=DMA
custom,0010080100001000,0,BID,GTC,N,66.35,90101=DMA
custom,0010080100001000,100,BID,GTC,N,66.35,90101=DMA
custom,0010080100001000,12555546,BID,GTC,N,66.35,90101=DMA
custom,0010080100001000,-12555546,BID,GTC,N,66.35,90101=DMA
custom,0010080100001000,100,BID,GTC,N,66.35,90101=DMA,90104=Y
custom,0010080100001000,100,BID,GTC,N,66.35,90101=DMA,90104=N
custom,0010080100001000,100,BID,GTC,N,66.35,90101=VWAP,168=20200108-15:28:12.309,126=20200108-15:28:12.309,90131=36
custom,0010080100001000,100,BID,GTC,N,66.35,90101=VWAP,90104=Y,168=20200108-15:28:12.309,126=20200108-15:28:12.309,90131=36
custom,0010080100001000,100,BID,GTC,N,66.35,90101=VWAP,90104=N,168=20200108-15:28:12.309,126=20200108-15:28:12.309,90131=36
custom,0010080100001000,100,BID,GTC,N,66.35,90101=POV,168=20200108-15:28:12.309,126=20200108-15:28:12.309,90131=36
custom,0010080100001000,100,BID,GTC,N,66.35,90101=POV,90104=Y,168=20200108-15:28:12.309,126=20200108-15:28:12.309,90131=36
custom,0010080100001000,100,BID,GTC,N,66.35,90101=POV,90104=N,168=20200108-15:28:12.309,126=20200108-15:28:12.309,90131=36
exit"

first="true"

SERVER=0

{
    for line in $lines
        do if [[ $first == "true" ]]
        then
            sleep 3
            if [ ! -z ${FAKE_VENUE+x} ] ; then
                $PYTHON -c "import ep_fake_venue as fake_venue; fake_venue.run()" &

                SERVER=$!
            fi
            first="false"
        fi
        sleep 1
        echo $line
    done
} | $PYTHON $CMD_UTIL_PATH --symbology $SYMBOLOGY_PATH --session $CFG_PATH --license $FM_LICENSE_PATH

if [ ! -z ${FAKE_VENUE+x} ] ; then
    kill -SIGINT $SERVER;
fi
